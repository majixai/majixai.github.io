body, h1, h2, h3, h4, h5, h6 {font-family: "Segoe UI", Arial, sans-serif}
.w3-row-padding, .w3-row { margin-left:-8px; margin-right:-8px; }
.w3-col { padding: 0 8px; }

.app-container {
    max-width: 1600px;
    margin: auto;
    padding: 0 16px;
}

.controls-bar .w3-card {
     margin-bottom: 16px !important;
}
.controls-bar h4 {
     margin-top: 0;
     margin-bottom: 0;
     cursor:pointer;
}

.controls-bar .w3-container.w3-hide {
     padding-top: 0 !important;
     padding-bottom: 0 !important;
}
.controls-bar .w3-section {
    margin-top: 8px !important;
    margin-bottom: 8px !important;
}
.controls-bar label {
     display: block;
     margin-bottom: 4px;
     font-weight: bold;
}
.controls-bar .w3-button {
     margin-bottom: 4px;
}
.controls-bar .quick-filters button {
     margin-right: 5px;
}
.controls-bar textarea {
     resize: vertical;
}

.main-content > .w3-col {
     padding: 8px;
     box-sizing: border-box;
}
.user-column, .iframe-column {
     transition: flex-basis 0.3s ease, max-width 0.3s ease;
}


#onlineUsers .user-list,
#previousUsers .user-list {
    max-height: 600px;
    overflow-y: auto;
    padding-right: 15px;
    box-sizing: border-box;
    scrollbar-width: thin;
    scrollbar-color: #888 #f1f1f1;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: flex-start;
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 4px;
    background-color: #f9f9f9;
}

#onlineUsers .user-list::-webkit-scrollbar,
#previousUsers .user-list::-webkit-scrollbar,
#messageList::-webkit-scrollbar,
#logDisplayArea .log-list::-webkit-scrollbar { width: 8px; height: 8px; }
#onlineUsers .user-list::-webkit-scrollbar-track,
#previousUsers .user-list::-webkit-scrollbar-track,
#messageList::-webkit-scrollbar-track,
#logDisplayArea .log-list::-webkit-scrollbar-track { background: #f1f1f1; }
#onlineUsers .user-list::-webkit-scrollbar-thumb,
#previousUsers .user-list::-webkit-scrollbar-thumb,
#messageList::-webkit-scrollbar-thumb,
#logDisplayArea .log-list::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
#onlineUsers .user-list::-webkit-scrollbar-thumb:hover,
#previousUsers .user-list::-webkit-scrollbar-thumb:hover,
#messageList::-webkit-scrollbar-thumb:hover,
#logDisplayArea .log-list::-webkit-scrollbar-thumb:hover { background: #555; }


.user-info {
    border: 1px solid #ccc;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    position: relative;
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s ease-in-out;
}
.user-info:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.user-info .user-details {
    padding: 8px;
    flex-grow: 1;
}

.user-info .username {
    font-weight: bold;
    margin: 0 0 5px 0;
    font-size: 1.1em;
}

.user-info .tags,
.user-info .user-details p small {
     color: #555;
     display: block;
     margin-bottom: 3px;
     font-size: 0.8em;
}
.user-info .tags {
    word-break: break-word;
}

.user-info .birthday {
     font-size: 0.9em;
     margin-top: 5px;
     font-weight: bold;
     color: #ff9800;
}
.user-info .age-days {
     font-weight: normal;
     font-style: italic;
}

.user-info .badge {
    margin-left: 5px;
    vertical-align: top;
}

.user-list.image-mode .user-info {
     flex-basis: calc(33.33% - 10px);
     min-width: 150px;
     display: flex;
     flex-direction: row;
     align-items: flex-start;
}
@media (max-width: 1200px) {
     .user-list.image-mode .user-info {
          flex-basis: calc(50% - 10px);
     }
}
@media (max-width: 600px) {
    .user-list.image-mode .user-info {
        flex-basis: 100%;
    }
}

.user-list.image-mode .user-image-container {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    overflow: hidden;
    position: relative;
}
.user-list.image-mode .user-image-container img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.user-list.image-mode .user-details {
    padding-left: 8px;
    padding-top: 8px !important;
}


.user-list.iframe-mode .user-info {
    flex-basis: calc(50% - 10px);
    min-width: 200px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
}
@media (max-width: 1200px) {
     .user-list.iframe-mode .user-info {
          flex-basis: calc(50% - 10px);
     }
}
@media (max-width: 600px) {
    .user-list.iframe-mode .user-info {
        flex-basis: 100%;
    }
}


.user-list.iframe-mode .iframe-container {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
    background-color: black;
     margin-bottom: 5px;
}
.user-list.iframe-mode .iframe-container iframe {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%; border: none;
}
.user-list.iframe-mode .click-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;
    background: transparent; cursor: pointer;
}

.recognition-results {
    margin-top: 5px;
    font-size: 0.75em;
    color: #007bff;
     word-break: break-word;
}
.recognition-results strong {
    font-weight: bold;
    color: #333;
     display: block;
}
.recognition-results ul {
    padding-left: 15px;
    margin: 0;
    list-style: disc;
}
.recognition-results li {
    margin-bottom: 2px;
}


.remove-user-btn {
     position: absolute;
     z-index: 15;
     top: 5px; right: 5px;
     opacity: 0.8;
     transition: opacity 0.2s ease-in-out;
}
.remove-user-btn:hover { opacity: 1; }


#mainViewerContainer {
    display: grid;
    gap: 8px;
    padding: 5px;
    background-color: #e0e0e0;
    border-radius: 8px;
     overflow: auto;
     scrollbar-width: thin;
     scrollbar-color: #888 #f1f1f1;
     min-height: 200px;
}

#mainViewerContainer::-webkit-scrollbar { width: 8px; height: 8px; }
#mainViewerContainer::-webkit-scrollbar-track { background: #f1f1f1; }
#mainViewerContainer::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
#mainViewerContainer::-webkit-scrollbar-thumb:hover { background: #555; }


.iframe-grid-container .iframe-wrapper {
    position: relative;
    width: 850px;
    height: 480px;
    background-color: black;
    overflow: hidden;
    border-radius: 4px;
     flex-shrink: 0;
}
.iframe-grid-container .iframe-wrapper iframe {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;
}

.iframe-grid-container.iframe-count-2 {
    grid-template-columns: 850px;
    grid-template-rows: 480px 480px;
    justify-content: center;
}
.iframe-grid-container.iframe-count-4 {
    grid-template-columns: 850px 850px;
    grid-template-rows: 480px 480px;
     justify-content: center;
}

@media (max-width: 992px) {
    .iframe-column {
        flex-basis: 100% !important;
        max-width: 100% !important;
    }
     .iframe-grid-container.iframe-count-4 {
         grid-template-columns: 850px;
         grid-template-rows: repeat(4, 480px);
         overflow-x: auto;
     }
     .iframe-grid-container.iframe-count-2 {
         grid-template-columns: 850px;
         grid-template-rows: repeat(2, 480px);
          overflow-x: auto;
     }
     .user-column {
          flex-basis: 100% !important;
          max-width: 100% !important;
     }
}


#messageList {
    max-height: 300px;
    overflow-y: auto;
    padding-right: 15px;
    box-sizing: border-box;
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 4px;
    background-color: #f9f9f9;
    display: block;
    scrollbar-width: thin;
    scrollbar-color: #888 #f1f1f1;
}

.message-item {
    background-color: #e9e9eb;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 8px 12px;
    margin-bottom: 5px;
    cursor: pointer;
    white-space: pre-wrap;
    word-break: break-word;
     font-size: 0.9em;
    transition: background-color 0.2s ease;
}
.message-item:hover {
    background-color: #dcdcdc;
}


.ui-autocomplete {
    max-height: 300px;
    overflow-y: auto; overflow-x: hidden;
    background-color: #fff; border: 1px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    z-index: 1000;
    list-style: none; padding: 0; margin: 0;
}
.ui-autocomplete .ui-menu-item { padding: 5px 10px; border-bottom: 1px solid #eee; cursor: pointer; }
.ui-autocomplete .ui-menu-item:last-child { border-bottom: none; }
.ui-autocomplete .ui-menu-item:hover,
.ui-autocomplete .ui-menu-item.ui-state-focus { background-color: #f1f1f1; }
.ui-menu-item .ui-menu-item-wrapper {
    padding: 5px 10px;
}
.ui-state-active, .ui-widget-content .ui-state-active, .ui-widget-header .ui-state-active {
    border: 1px solid #003eff;
    background: #e9e9eb;
    color: #000;
    font-weight: normal;
}


#toggleAutoScroll.w3-green { background-color: #4CAF50 !important; color: white !important; }
#toggleAutoScroll.w3-red { background-color: #f44336 !important; color: white !important; }
#toggleAutoScroll:disabled { opacity: 0.6; cursor: not-allowed; }

#toggleDisplayMode, #toggleIframeCount, #showLogsButton, #clearLogsButton,
.quick-filter-btn {
    background-color: #f1f1f1; color: #000; border: 1px solid #ccc;
}
#toggleDisplayMode:hover, #toggleIframeCount:hover, #showLogsButton:hover, #clearLogsButton:hover,
.quick-filter-btn:hover { background-color: #ddd; }
#toggleDisplayMode:disabled, #toggleIframeCount:disabled, #showLogsButton:disabled, #clearLogsButton:disabled,
.quick-filter-btn:disabled {
    opacity: 0.6; cursor: not-allowed; background-color: #f1f1f1 !important; color: #000 !important;
}

#saveMessageButton { background-color: #007bff !important; color: white !important; }
#saveMessageButton:disabled { opacity: 0.6; cursor: not-allowed; }


.status-message { margin-top: 10px; padding: 8px; border-radius: 4px; display: none; font-size: 0.9em; word-break: break-word; }
.status-message.info { color: inherit; background-color: transparent; border: none;}
.status-message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;}
.status-message.warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba;}
.status-message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;}
.status-message.loading { color: #555; font-style: italic; display: inline-block !important; border: none; background-color: transparent;}


#reportLoadingIndicator, #onlineLoadingIndicator, #recognitionStatus {
    font-style: italic; color: #555;
}
#reportLoadingIndicator { margin-left: 10px; display: none; }
#onlineLoadingIndicator { text-align: center; padding: 10px; display: none; }
#recognitionStatus { display: inline-block; margin-left: 5px;}

#onlineErrorDisplay { text-align: center; padding: 10px; border: 1px solid red; background-color: #ffe6e6; margin-bottom: 10px; display: none; }


#onlineUsers .user-list > p.text-muted,
#previousUsers .user-list > p.text-muted,
#messageList > p.text-muted {
    text-align: center;
    padding: 20px;
    width: 100%;
    box-sizing: border-box;
}


#logDisplayArea {
    margin-top: 20px !important;
    margin-bottom: 20px !important;
    background-color: #f8f8f8;
    border: 1px solid #ddd;
    border-radius: 4px;
}
#logDisplayArea h4 { margin-top: 0; margin-bottom: 10px;}

#logDisplayArea .log-list {
    max-height: 300px;
    overflow-y: auto;
    font-size: 0.8em;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    background-color: #fff;
    padding: 5px;
    border: 1px solid #eee;
    border-radius: 4px;
}

.log-entry {
    border-bottom: 1px dashed #eee;
    padding: 3px 0;
    word-break: break-word;
    white-space: pre-wrap;
     display: flex;
     align-items: baseline;
}
.log-entry:last-child { border-bottom: none; }

.log-info { color: #333; }
.log-log { color: #333; }
.log-warn { color: #ff9800; font-weight: bold;}
.log-error { color: #f44336; font-weight: bold;}
.log-debug { color: #999; }

.log-timestamp {
    color: #666;
    margin-right: 8px;
    font-size: 0.9em;
     flex-shrink: 0;
}

.log-entry .log-message {
     flex-grow: 1;
}

/* Basic layout adjustments for W3.CSS grid */
.app-container {
    max-width: 1600px; /* Or a suitable max width */
    margin: auto; /* Center the container */
}

.main-content {
     /* Ensure columns within main-content use flexbox for layout */
    display: flex;
    flex-wrap: wrap; /* Allow wrapping for smaller screens */
    gap: 16px; /* Add some spacing between columns */
}

.user-column {
    /* Override default W3.CSS padding/margin if needed, or rely on gap */
     padding: 0;
     margin: 0;
     /* Use W3.CSS col classes for width */
}

.iframe-column {
    /* Override default W3.CSS padding/margin if needed, or rely on gap */
     padding: 0;
     margin: 0;
    /* Use W3.CSS col classes for width */
    flex-grow: 1; /* Allow viewer column to take available space */
    min-width: 300px; /* Ensure viewer column doesn't collapse too much */
}


/* Styles for the user lists */
.user-list {
    max-height: 600px; /* Limit height and make scrollable */
    overflow-y: auto;
    padding-right: 8px; /* Add padding for scrollbar */
     margin-top: 8px;
}

/* Optional: Style for scrollbar */
.user-list::-webkit-scrollbar {
    width: 8px;
}

.user-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.user-list::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 10px;
}

.user-list::-webkit-scrollbar-thumb:hover {
    background: #555;
}


.user-info {
    cursor: pointer;
    position: relative; /* Needed for absolute positioning of remove button/overlay */
    overflow: hidden; /* Hide anything outside the border radius or container */
     transition: background-color 0.2s ease;
}

.user-info:hover {
    background-color: #f1f1f1; /* Light highlight on hover */
}

/* Image Mode for User List Items */
.image-display-mode .user-image-container {
     width: 100%;
     overflow: hidden;
}

.image-display-mode .user-image-container img {
    display: block;
    width: 100%;
    height: auto; /* Maintain aspect ratio */
}

.image-display-mode .user-details {
    padding-top: 4px; /* Reduce padding slightly in image mode */
}

/* Iframe Mode for User List Items */
.iframe-display-mode .iframe-container {
    position: relative;
    width: 100%;
    /* Calculate height based on aspect ratio 16:9, 0.5625 = 9/16 */
    padding-top: 56.25%; /* This creates a 16:9 aspect ratio container */
    overflow: hidden; /* Hide anything that overflows */
}

.iframe-display-mode .iframe-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
}

.iframe-display-mode .user-details {
    display: none; /* Hide details block in iframe list mode */
}

/* Click overlay for iframes in lists */
.iframe-container .click-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10; /* Make sure it's above the iframe */
    cursor: pointer;
}


/* Remove button for history items */
.remove-user-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    z-index: 5; /* Make sure it's above the image/iframe */
     padding: 2px 6px; /* Adjust padding */
     line-height: 1; /* Vertically center the 'x' */
     opacity: 0.8; /* Slightly transparent */
     transition: opacity 0.2s ease;
}

.remove-user-btn:hover {
    opacity: 1;
}


/* Image recognition results */
.recognition-results {
    margin-top: 5px;
    padding-top: 5px;
    border-top: 1px dashed #ccc; /* Separator */
    font-size: 0.8em; /* Smaller font */
}

.recognition-results ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.recognition-results li {
    margin: 0;
    padding: 2px 0;
}

/* Loading indicator styles */
.loading-indicator, .status-message.loading {
    font-style: italic;
    opacity: 0.7;
}
/* Specific status message colors */
.status-message.success { color: green; }
.status-message.warning { color: orange; }
.status-message.error { color: red; }
.status-message.info { color: grey; }


/* Log Display Area */
.log-list {
    max-height: 300px; /* Limit height */
    overflow-y: auto;
    border: 1px solid #ccc;
    padding: 10px;
    background-color: #f9f9f9;
    font-family: monospace;
    font-size: 0.9em;
    white-space: pre-wrap; /* Respect line breaks */
    word-break: break-word; /* Break long words */
}

.log-entry {
    margin-bottom: 5px;
    padding-bottom: 5px;
    border-bottom: 1px dashed #eee;
}

.log-entry:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.log-timestamp {
    color: #888;
    margin-right: 5px;
}

.log-entry.log-warn {
    color: #c09853; /* Orange/Yellow */
}

.log-entry.log-error {
    color: #b94a48; /* Red */
    font-weight: bold;
}

/* Main Viewer Styles */
.iframe-grid-container {
    width: 100%;
    height: auto; /* Height will be determined by content/grid rows */
    display: grid; /* Use CSS Grid for layout */
    gap: 10px; /* Gap between iframes */
}

/* Layout for 2 iframes */
.iframe-count-2 {
    /* On large screens (l6), this container is typically ~50% width. */
    /* Arrange into 2 columns, 1 row */
     grid-template-columns: repeat(2, 1fr);
     grid-template-rows: 1fr; /* Single row */
     height: 480px; /* Fixed height for 2-up mode based on original HTML comment */
}

/* Layout for 4 iframes (2x2 grid) */
.iframe-count-4 {
     /* Arrange into 2 columns, 2 rows */
     grid-template-columns: repeat(2, 1fr);
     grid-template-rows: repeat(2, 1fr);
     /* Adjust height calculation: 2 rows, each approximately half of the 2-up height + gap */
     /* (480px - gap) / 2 * 2 + gap => 480 */
     /* A simple auto height might stretch, or calculate based on desired aspect ratio within cells */
     /* Let's rely on the iframes filling their cells within the grid */
     height: 480px; /* Keeping fixed height for consistency, grid handles internal sizing */
}

.iframe-wrapper {
    width: 100%;
    height: 100%; /* Fill the grid cell */
    overflow: hidden; /* Hide overflow */
    border: 1px solid #ccc; /* Optional border */
    box-sizing: border-box; /* Include border in sizing */
}

.iframe-wrapper iframe {
    width: 100%;
    height: 100%; /* Make iframe fill its wrapper */
    border: none; /* Remove iframe's default border */
}

/* Adjust radio button layout */
.iframe-choice-radios {
    margin-top: 10px;
}
.iframe-choice-radios input {
    margin-right: 5px;
}

/* Style for age days span */
.age-days {
    font-weight: bold;
    color: green; /* Or another highlight color */
}

/* Style for new badge */
.badge.new-badge {
    vertical-align: middle; /* Align badge with text */
    margin-left: 5px;
}

/* Responsive adjustments (optional - W3.CSS handles much of this) */
@media (max-width: 992px) { /* Medium screens (m8 for viewer) */
     .main-content {
          flex-direction: column; /* Stack columns */
     }
     .user-column, .iframe-column {
          width: 100%; /* Take full width when stacked */
     }
}

@media (max-width: 600px) { /* Small screens (s12) */
      /* Already handled by W3.CSS s12 */
}
