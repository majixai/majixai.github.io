body, h1, h2, h3, h4, h5, h6 {font-family: "Segoe UI", Arial, sans-serif}
.w3-row-padding, .w3-row { margin-left:-8px; margin-right:-8px; }
.w3-col { padding: 0 8px; } /* Ensure consistent padding between columns */


.app-container {
    max-width: 1600px; /* Increased max-width to accommodate potential 4 iframes + lists */
    margin: auto;
    padding: 0 16px;
}

/* Controls Bar Styling */
.controls-bar .w3-card {
     margin-bottom: 16px !important; /* Ensure space below the controls card */
}
.controls-bar h4 {
     margin-top: 0;
     margin-bottom: 0;
     cursor:pointer;
}

.controls-bar .w3-container.w3-hide {
     padding-top: 0 !important;
     padding-bottom: 0 !important;
}
.controls-bar .w3-section {
    margin-top: 8px !important;
    margin-bottom: 8px !important;
}
.controls-bar label {
     display: block;
     margin-bottom: 4px;
     font-weight: bold;
}
.controls-bar .w3-button {
     margin-bottom: 4px;
}
.controls-bar .quick-filters button {
     margin-right: 5px;
}
.controls-bar textarea {
     resize: vertical; /* Allow vertical resizing */
}

/* Main content area - use flexbox or W3.CSS grid */
.main-content > .w3-col {
    /* W3.CSS columns handle basic responsiveness */
     padding: 8px; /* Add some spacing between columns */
     box-sizing: border-box; /* Include padding in element size */
}
/* Adjust column widths using W3.CSS classes directly in HTML based on state in JS */
/* .w3-col.l3, .w3-col.m4, .w3-col.m8, .w3-col.l6, .w3-col.l9 etc. */


/* User List Containers (Online and History) */
#onlineUsers .user-list,
#previousUsers .user-list,
#messageList { /* Include message list */
    max-height: 600px; /* Fixed height for scrolling */
    overflow-y: auto;
    padding-right: 15px;
    box-sizing: border-box;
    scrollbar-width: thin;
    scrollbar-color: #888 #f1f1f1;
    display: flex; /* Use flexbox for layout */
    flex-wrap: wrap; /* Allow items to wrap */
    gap: 10px; /* Gap between user items */
    align-items: flex-start; /* Align items to the top */
    border: 1px solid #ccc; /* Add border to lists */
    padding: 10px; /* Internal padding */
    border-radius: 4px;
    background-color: #f9f9f9;
}

#onlineUsers .user-list::-webkit-scrollbar,
#previousUsers .user-list::-webkit-scrollbar,
#messageList::-webkit-scrollbar { width: 8px; }
#onlineUsers .user-list::-webkit-scrollbar-track,
#previousUsers .user-list::-webkit-scrollbar-track,
#messageList::-webkit-scrollbar-track { background: #f1f1f1; }
#onlineUsers .user-list::-webkit-scrollbar-thumb,
#previousUsers .user-list::-webkit-scrollbar-thumb,
#messageList::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
#onlineUsers .user-list::-webkit-scrollbar-thumb:hover,
#previousUsers .user-list::-webkit-scrollbar-thumb:hover,
#messageList::-webkit-scrollbar-thumb:hover { background: #555; }


/* --- User Item Styling --- */
.user-info {
    border: 1px solid #ccc;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    position: relative;
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s ease-in-out;
}
.user-info:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.user-info .user-details {
    padding: 8px;
    flex-grow: 1;
}

.user-info .username {
    font-weight: bold;
    margin: 0 0 5px 0;
    font-size: 1.1em;
}

.user-info .tags,
.user-info .user-details p small {
     color: #555;
     display: block;
     margin-bottom: 3px;
     font-size: 0.8em;
}
.user-info .tags {
    word-break: break-word;
}

.user-info .birthday {
     font-size: 0.9em;
     margin-top: 5px;
     font-weight: bold;
     color: #ff9800;
}
.user-info .age-days {
     font-weight: normal; /* Less emphasis on the days count */
     font-style: italic;
}


/* Styles specific to IMAGE display mode */
.user-list.image-mode .user-info {
     flex-basis: calc(33.33% - 10px); /* Default 3 items per row */
     min-width: 150px;
     display: flex;
     flex-direction: row;
     align-items: flex-start;
}
/* Responsive adjustments for image mode */
@media (max-width: 1200px) { /* Adjust based on your layout needs */
     .user-list.image-mode .user-info {
          flex-basis: calc(50% - 10px); /* 2 items per row */
     }
}
@media (max-width: 600px) {
    .user-list.image-mode .user-info {
        flex-basis: 100%; /* 1 item per row */
    }
}

.user-list.image-mode .user-image-container {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    overflow: hidden;
    position: relative;
}
.user-list.image-mode .user-image-container img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.user-list.image-mode .user-details {
    padding-left: 8px;
    padding-top: 8px !important;
}


/* Styles specific to IFRAME display mode */
.user-list.iframe-mode .user-info {
    flex-basis: calc(50% - 10px); /* Default 2 items per row */
    min-width: 200px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
}
/* Responsive adjustments for iframe mode */
@media (max-width: 1200px) { /* Adjust based on your layout needs */
     .user-list.iframe-mode .user-info {
          flex-basis: calc(50% - 10px); /* Still 2 items */
     }
}
@media (max-width: 600px) {
    .user-list.iframe-mode .user-info {
        flex-basis: 100%; /* 1 item */
    }
}


.user-list.iframe-mode .iframe-container {
    position: relative;
    width: 100%; /* Takes full width of its flex-basis item */
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    height: 0;
    overflow: hidden;
    background-color: black;
     margin-bottom: 5px;
}
.user-list.iframe-mode .iframe-container iframe {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%; border: none;
}
.user-list.iframe-mode .click-overlay { /* Overlay div to capture clicks */
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;
    background: transparent; cursor: pointer;
}

/* Image Recognition Results Styling */
.recognition-results {
    margin-top: 5px;
    font-size: 0.75em; /* Smaller font */
    color: #007bff; /* Blue color */
     word-break: break-word; /* Prevent overflow */
}
.recognition-results strong {
    font-weight: bold;
    color: #333; /* Darker color for "Recognized:" */
     display: block; /* Put label on its own line */
}
.recognition-results ul {
    padding-left: 15px; /* Indent list */
    margin: 0;
    list-style: disc;
}
.recognition-results li {
    margin-bottom: 2px;
}


/* Remove button positioning */
.remove-user-btn {
     position: absolute;
     z-index: 15;
     top: 5px; right: 5px;
     opacity: 0.8;
     transition: opacity 0.2s ease-in-out;
}
.remove-user-btn:hover { opacity: 1; }


/* --- Main Viewer Iframe Grid --- */
.iframe-grid-container {
    display: grid;
    gap: 8px;
    padding: 5px;
    background-color: #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
    /* Base aspect ratio, adjust based on column size */
    aspect-ratio: 16/9;
}
/* Adjust grid columns/rows based on iframe count state class */
.iframe-grid-container.iframe-count-2 {
    grid-template-columns: 1fr;
    grid-template-rows: repeat(2, 1fr);
}
.iframe-grid-container.iframe-count-4 {
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, 1fr);
}

.iframe-grid-container .iframe-wrapper {
    position: relative; width: 100%; height: 100%;
    background-color: black;
    overflow: hidden;
    border-radius: 4px;
}
.iframe-grid-container .iframe-wrapper iframe {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;
}

/* Optional: Responsive adjustments for the main viewer grid */
@media (max-width: 768px) {
    .iframe-grid-container.iframe-count-4 {
        grid-template-columns: 1fr; /* Stack iframes in one column on smaller screens */
        grid-template-rows: repeat(4, auto);
        aspect-ratio: auto;
    }
     .iframe-grid-container.iframe-count-4 .iframe-wrapper {
         height: 200px; /* Example fixed height for stacked */
     }
     .iframe-grid-container.iframe-count-2 {
         grid-template-columns: 1fr;
         grid-template-rows: repeat(2, auto);
         aspect-ratio: auto;
     }
      .iframe-grid-container.iframe-count-2 .iframe-wrapper {
         height: 250px; /* Example fixed height for stacked */
     }
}

/* --- Iframe Size Control (handled by JS toggling W3.CSS classes) --- */
/* Examples: .iframe-column.w3-col.l6, .iframe-column.w3-col.l8, .iframe-column.w3-col.l9 */
/* Add transition to the iframe-column itself */
.iframe-column {
     transition: flex-basis 0.3s ease, max-width 0.3s ease;
}
/* User columns also transition */
.user-column {
     transition: flex-basis 0.3s ease, max-width 0.3s ease;
}
/* Ensure column percentages add up to ~100% */
.w3-row > .user-column:first-child { max-width: 25%; } /* Base size */
.w3-row > .user-column:last-child { max-width: 25%; } /* Base size */

/* Adjust sibling user columns when iframe column gets bigger */
.iframe-column.w3-col.l8 ~ .user-column:first-child,
.iframe-column.w3-col.l8 ~ .user-column:last-child {
     max-width: 16.66%; /* l8 (66.66%) + 16.66% + 16.66% = ~100% */
}
.iframe-column.w3-col.l9 ~ .user-column:first-child,
.iframe-column.w3-col.l9 ~ .user-column:last-child {
     max-width: 12.5%; /* l9 (75%) + 12.5% + 12.5% = 100% */
}

/* Media query for smaller screens where columns stack anyway */
@media (max-width: 992px) {
    .iframe-column,
    .user-column {
        flex-basis: 100% !important; /* Override flex-basis for stacking */
        max-width: 100% !important; /* Override max-width for stacking */
    }
}


/* --- Message List Styling --- */
#messageList.user-list { /* Reuse .user-list styles, add specific overrides */
    display: block; /* Use block layout for simple stacking */
    gap: 0; /* Remove gap from flexbox */
    padding: 5px; /* Adjust padding */
}

/* Style for individual message elements */
.message-item {
    background-color: #e9e9eb; /* Light grey background */
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 8px 12px;
    margin-bottom: 5px; /* Space between messages */
    cursor: pointer;
    white-space: pre-wrap; /* Preserve line breaks and wrap text */
    word-break: break-word; /* Break long words */
     font-size: 0.9em;
    transition: background-color 0.2s ease;
    position: relative; /* For potential delete button */
}
.message-item:hover {
    background-color: #dcdcdc; /* Slightly darker on hover */
}

/* Optional: Add a delete button for messages */
/*
.message-item .delete-msg-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: red;
    color: white;
    border: none;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 0.7em;
    line-height: 1;
    text-align: center;
    cursor: pointer;
    opacity: 0.7;
}
.message-item .delete-msg-btn:hover {
    opacity: 1;
}
*/

/* --- Autocomplete Styling --- */
/* Basic styling for the jQuery UI autocomplete dropdown */
.ui-autocomplete {
    max-height: 300px;
    overflow-y: auto; overflow-x: hidden;
    background-color: #fff; border: 1px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    z-index: 1000;
    list-style: none; padding: 0; margin: 0;
}
.ui-autocomplete .ui-menu-item { padding: 5px 10px; border-bottom: 1px solid #eee; cursor: pointer; }
.ui-autocomplete .ui-menu-item:last-child { border-bottom: none; }
.ui-autocomplete .ui-menu-item:hover,
.ui-autocomplete .ui-menu-item.ui-state-focus { background-color: #f1f1f1; }


/* --- Button Styling --- */

/* Style for the auto-scroll button */
#toggleAutoScroll.w3-green { background-color: #4CAF50 !important; color: white !important; }
#toggleAutoScroll.w3-red { background-color: #f44336 !important; color: white !important; }
#toggleAutoScroll:disabled { opacity: 0.6; cursor: not-allowed; }

/* Style for the Display mode toggle button */
#toggleDisplayMode, #toggleIframeCount,
#increaseIframeSize, #decreaseIframeSize,
.quick-filter-btn {
    background-color: #f1f1f1; color: #000; border: 1px solid #ccc;
}
#toggleDisplayMode:hover, #toggleIframeCount:hover,
#increaseIframeSize:hover, #decreaseIframeSize:hover,
.quick-filter-btn:hover { background-color: #ddd; }
#toggleDisplayMode:disabled, #toggleIframeCount:disabled,
#increaseIframeSize:disabled, #decreaseIframeSize:disabled,
.quick-filter-btn:disabled {
    opacity: 0.6; cursor: not-allowed; background-color: #f1f1f1 !important; color: #000 !important;
}

/* Style for Save Message button */
#saveMessageButton { background-color: #007bff !important; color: white !important; }


/* Report Status Styling */
.report-status, .message-status { margin-top: 10px; padding: 8px; border-radius: 4px; display: none; font-size: 0.9em; }
.report-status.info, .message-status.info { background-color: #2196F3; color: white; border-left: 6px solid #03a9f4;} /* Blue */
.report-status.success, .message-status.success { background-color: #4CAF50; color: white; border-left: 6px solid #8bc34a;} /* Green */
.report-status.warning, .message-status.warning { background-color: #ff9800; color: white; border-left: 6px solid #ffc107;} /* Orange */
.report-status.error, .message-status.error { background-color: #f44336; color: white; border-left: 6px solid #e57373;} /* Red */


/* Loading Indicators */
#reportLoadingIndicator, #onlineLoadingIndicator, #recognitionStatus, .message-status.loading {
    font-style: italic; color: #555;
}
#reportLoadingIndicator { margin-left: 10px; }
#onlineLoadingIndicator { text-align: center; padding: 10px; }
#recognitionStatus { display: inline-block; margin-left: 5px;} /* Adjust display */

/* Error Messages */
#onlineErrorDisplay { text-align: center; padding: 10px; border: 1px solid red; background-color: #ffe6e6; margin-bottom: 10px; }

/* Ensure placeholders/messages are centered */
#onlineUsers .user-list > p.text-muted,
#previousUsers .user-list > p.text-muted,
#messageList > p.text-muted {
    text-align: center;
    padding: 20px;
    width: 100%;
    box-sizing: border-box;
}
