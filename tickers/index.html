<!DOCTYPE html>
<html>
<head>
    <title>Plot Curve from 3 Points with Data Storage</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: sans-serif; }
        .point-input { margin-bottom: 10px; }
        .point-input label { display: block; margin-bottom: 5px; font-weight: bold; }
        .point-input input { padding: 8px; width: 100px; margin-right: 10px; }
        button { padding: 10px 15px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
        #plot-area { width: 800px; height: 600px; margin-top: 20px; }
        #data-display { margin-top: 20px; padding: 15px; border: 1px solid #ddd; }
        #data-display h2 { margin-top: 0; }
        #input-points-display, #amplitude-display, #storage-status { margin-bottom: 10px; }
        #input-points-display pre, #amplitude-display pre, #storage-status pre { background-color: #f8f8f8; padding: 10px; border: 1px solid #eee; }
        #storage-status pre { font-size: 0.9em; color: #777; }
    </style>
</head>
<body>

    <h1>Curve from 3 XY Points with Local Storage using Plotly.js</h1>

    <div class="point-input">
        <label>Point 1:</label>
        <input type="number" id="x1" placeholder="X1" value="1">
        <input type="number" id="y1" placeholder="Y1" value="2">
    </div>

    <div class="point-input">
        <label>Point 2:</label>
        <input type="number" id="x2" placeholder="X2" value="3">
        <input type="number" id="y2" placeholder="Y2" value="4">
    </div>

    <div class="point-input">
        <label>Point 3:</label>
        <input type="number" id="x3" placeholder="X3" value="5">
        <input type="number" id="y3" placeholder="Y3" value="1">
    </div>

    <button id="plot-button">Plot Curve</button>
    <button id="save-points-button">Save Points</button>
    <button id="load-points-button">Load Points</button>

    <div id="plot-area"></div>

    <div id="data-display">
        <h2>Relevant Data</h2>
        <div id="input-points-display">
            <h3>Input Points:</h3>
            <pre id="input-points-output"></pre>
        </div>
        <div id="amplitude-display">
            <h3>Amplitude (Range of Y-values):</h3>
            <pre id="amplitude-output"></pre>
        </div>
        <div id="storage-status">
            <pre id="storage-output"></pre>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', initializePage);
        document.getElementById('plot-button').addEventListener('click', plotCurve);
        document.getElementById('save-points-button').addEventListener('click', savePointsToLocalStorage);
        document.getElementById('load-points-button').addEventListener('click', loadPointsFromLocalStorage);

        function initializePage() {
            loadPointsFromLocalStorage(); // Load points on page load
        }

        function getPointsFromInput() {
            return {
                x1: parseFloat(document.getElementById('x1').value),
                y1: parseFloat(document.getElementById('y1').value),
                x2: parseFloat(document.getElementById('x2').value),
                y2: parseFloat(document.getElementById('y2').value),
                x3: parseFloat(document.getElementById('x3').value),
                y3: parseFloat(document.getElementById('y3').value)
            };
        }

        function setInputFields(points) {
            document.getElementById('x1').value = points.x1;
            document.getElementById('y1').value = points.y1;
            document.getElementById('x2').value = points.x2;
            document.getElementById('y2').value = points.y2;
            document.getElementById('x3').value = points.x3;
            document.getElementById('y3').value = points.y3;
        }


        function savePointsToLocalStorage() {
            const points = getPointsFromInput();
            localStorage.setItem('curvePoints', JSON.stringify(points));
            document.getElementById('storage-output').textContent = "Points saved to local storage.";
        }

        function loadPointsFromLocalStorage() {
            const storedPointsJSON = localStorage.getItem('curvePoints');
            if (storedPointsJSON) {
                try {
                    const storedPoints = JSON.parse(storedPointsJSON);
                    setInputFields(storedPoints);
                    document.getElementById('storage-output').textContent = "Points loaded from local storage.";
                } catch (e) {
                    console.error("Error parsing stored points from localStorage:", e);
                    document.getElementById('storage-output').textContent = "Error loading points from local storage.";
                }
            } else {
                document.getElementById('storage-output').textContent = "No points found in local storage.";
            }
        }


        function plotCurve() {
            const points = getPointsFromInput();

            const xPoints = [points.x1, points.x2, points.x3];
            const yPoints = [points.y1, points.y2, points.y3];

            // Function to calculate Lagrange interpolation polynomial (same as before)
            function interpolateLagrange(xValues, yValues) {
                return function(x) {
                    let result = 0;
                    for (let i = 0; i < xValues.length; i++) {
                        let term = yValues[i];
                        for (let j = 0; j < xValues.length; j++) {
                            if (i !== j) {
                                term *= (x - xValues[j]) / (xValues[i] - xValues[j]);
                            }
                        }
                        result += term;
                    }
                    return result;
                };
            }

            const lagrangePolynomial = interpolateLagrange(xPoints, yPoints);

            // Generate points for the curve (same as before)
            const minX = Math.min(...xPoints);
            const maxX = Math.max(...xPoints);
            const curveXValues = [];
            const curveYValues = [];
            for (let x = minX - 1; x <= maxX + 1; x += 0.1) {
                curveXValues.push(x);
                curveYValues.push(lagrangePolynomial(x));
            }

            // Plotly traces (same as before)
            const pointsTrace = {
                x: xPoints,
                y: yPoints,
                mode: 'markers',
                type: 'scatter',
                name: 'Input Points',
                marker: { size: 10 }
            };

            const curveTrace = {
                x: curveXValues,
                y: curveYValues,
                mode: 'lines',
                type: 'scatter',
                name: 'Curve',
                line: { shape: 'linear' }
            };

            const layout = {
                title: 'Curve Interpolation from 3 Points',
                xaxis: { title: 'X' },
                yaxis: { title: 'Y' }
            };

            Plotly.newPlot('plot-area', [pointsTrace, curveTrace], layout);

            // ---- Display Relevant Data ----
            displayRelevantData(xPoints, yPoints, curveYValues);
        }

        function displayRelevantData(xPoints, yPoints, curveYValues) {
            // Display Input Points
            const inputPointsText = xPoints.map((x, index) => `(${x}, ${yPoints[index]})`).join(', ');
            document.getElementById('input-points-output').textContent = inputPointsText;

            // Calculate and Display Amplitude
            if (curveYValues.length > 0) {
                const minY = Math.min(...curveYValues);
                const maxY = Math.max(...curveYValues);
                const amplitude = maxY - minY;
                document.getElementById('amplitude-output').textContent = amplitude.toFixed(2); // Display amplitude with 2 decimal places
            } else {
                document.getElementById('amplitude-output').textContent = "N/A (No curve data)";
            }
        }
    </script>

</body>
</html>
