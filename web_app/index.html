<!DOCTYPE html>
<html>
<head>
  <title>Football Game</title>
  <style>
    body, html {
      height: 100%;
      margin: 0;
    }

    .game-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    canvas {
      background-color: rgba(0, 100, 0, 0.5);
      border: 1px solid #FFFFFF;
    }

    #controller {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
    }

    #d-pad {
      position: relative;
      width: 120px;
      height: 120px;
    }

    .d-pad-button {
      position: absolute;
      width: 40px;
      height: 40px;
      background-color: #555;
      border: 1px solid #FFF;
      transition: all 0.1s ease-in-out;
    }

    .d-pad-button:active {
      transform: scale(0.9);
    }

    #up { top: 0; left: 40px; }
    #down { bottom: 0; left: 40px; }
    #left { top: 40px; left: 0; }
    #right { top: 40px; right: 0; }

    #action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 10px;
      margin-left: 20px;
    }

    .action-button {
      width: 50px;
      height: 50px;
      background-color: #555;
      border: 1px solid #FFF;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      transition: all 0.1s ease-in-out;
    }

    .action-button:active {
      transform: scale(0.9);
    }

    #shoulder-buttons {
      position: absolute;
      top: -30px;
      width: 100%;
      display: flex;
      justify-content: space-between;
    }

    .shoulder-button {
      width: 60px;
      height: 30px;
      background-color: #555;
      border: 1px solid #FFF;
    }

    .selected-receiver {
      border: 2px solid yellow;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>Football Game</h1>
    <canvas id="gameCanvas"></canvas>
    <div id="commentary"></div>
    <div id="controller">
      <div id="d-pad">
        <div id="up" class="d-pad-button"></div>
        <div id="down" class="d-pad-button"></div>
        <div id="left" class="d-pad-button"></div>
        <div id="right" class="d-pad-button"></div>
      </div>
      <div id="action-buttons">
        <div id="a-button" class="action-button">A</div>
        <div id="b-button" class="action-button">B</div>
        <div id="c-button" class="action-button">C</div>
        <div id="d-button" class="action-button">D</div>
      </div>
      <div id="shoulder-buttons">
        <div id="l-button" class="shoulder-button">L</div>
        <div id="r-button" class="shoulder-button">R</div>
      </div>
    </div>
    <button id="startButton">Start</button>
    <button id="stopButton">Stop</button>
    <button id="saveButton">Save</button>
    <button id="loadButton">Load</button>
    <div id="settingsPanel">
      <h3>Settings</h3>
      <label for="playerSpeed">Player Speed:</label>
      <input type="range" id="playerSpeed" min="1" max="10" value="5">
      <br>
      <label for="ballColor">Ball Color:</label>
      <input type="color" id="ballColor" value="#FFFFFF">
    </div>
  </div>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let player = {
      x: 50,
      y: 200,
      width: 20,
      height: 20,
      speed: 5,
      animation: 'run',
      angle: 0,
    };

    let ball = {
      x: 400,
      y: 200,
      radius: 5,
      dx: 0,
      dy: 0,
      speed: 10,
      isThrown: false,
      color: '#FFFFFF',
    };

    let opponents = [];
    for (let i = 0; i < 5; i++) {
      opponents.push({
        x: Math.random() * 2000 - 1000,
        y: Math.random() * 1000 - 500,
        width: 20,
        height: 20,
        speed: 2,
      });
    }

    let score = 0;
    let touchdownMessage = false;
    let gameClock = 15 * 60;
    let quarter = 1;
    let currentPlay;
    let selectedReceiver = 'A';

    const spriteSheet = new Image();
    spriteSheet.src = 'spritesheet.png';
    const animationManager = new AnimationManager(spriteSheet, 20, 20);
    animationManager.define('run', [0, 1, 2, 3], 0.1);
    animationManager.define('pass', [4, 5, 6, 7], 0.1);
    animationManager.define('jump', [8, 9, 10, 11], 0.1);
    animationManager.define('spin', [12, 13, 14, 15], 0.1);
    animationManager.define('dive', [16, 17, 18, 19], 0.1);

    function update() {
      if (currentPlay) {
        if (currentPlay.type === 'pass') {
          // Passing logic
          if (controller.a) passTo('A');
          if (controller.b) passTo('B');
          if (controller.c) passTo('C');
          if (controller.d) passTo('D');
        } else if (currentPlay.type === 'run') {
          // Running logic
          if (controller.up) {
            player.x += Math.sin(player.angle) * player.speed;
            player.y -= Math.cos(player.angle) * player.speed;
          }
          if (controller.down) {
            player.x -= Math.sin(player.angle) * player.speed;
            player.y += Math.cos(player.angle) * player.speed;
          }
          if (controller.left) {
            player.angle -= 0.1;
          }
          if (controller.right) {
            player.angle += 0.1;
          }

          if (controller.a) jump();
          if (controller.b) spin();
          if (controller.c) dive();
        }
      } else {
        // No play selected, wait for user to press 'A'
        if (controller.a) {
          showPlayCallingScreen();
        }

        // Pre-snap motion
        if (controller.b) {
          sendPlayerInMotion('B');
        }

        // Audibles
        if (controller.l) {
          audible('left');
        }
        if (controller.r) {
          audible('right');
        }
      }

      // Update game clock
      gameClock -= 1 / 60;
      if (gameClock <= 0) {
        quarter++;
        gameClock = 15 * 60;
      }

      animationManager.update(player.animation, 1 / 60);
    }

    function passTo(receiver) {
      player.animation = 'pass';
      sounds.tackle.play();
    }

    function jump() {
      player.animation = 'jump';
    }

    function spin() {
      player.animation = 'spin';
    }

    function dive() {
      player.animation = 'dive';
    }

    function render() {
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Save the current context state
      ctx.save();

      // Translate the canvas to follow the player from a third-person perspective
      const cameraX = player.x - canvas.width / 2;
      const cameraY = player.y - canvas.height / 2 - 100;
      ctx.translate(-cameraX, -cameraY);

      // Draw field
      ctx.fillStyle = '#006400';
      ctx.fillRect(-1000, -500, 2000, 1000);

      // Draw yard lines
      ctx.strokeStyle = '#FFFFFF';
      ctx.lineWidth = 1;
      for (let i = -1000; i <= 1000; i += 50) {
        ctx.beginPath();
        ctx.moveTo(i, -500);
        ctx.lineTo(i, 500);
        ctx.stroke();
      }

      // Draw goalposts
      ctx.fillStyle = '#FFFF00';
      ctx.fillRect(-20, -100, 10, 200);
      ctx.fillRect(10, -100, 10, 200);
      ctx.fillRect(-20, -100, 40, 10);
      ctx.fillRect(1970, -100, 10, 200);
      ctx.fillRect(1980, -100, 10, 200);
      ctx.fillRect(1970, -100, 20, 10);

      // Draw player
      ctx.save();
      ctx.translate(player.x, player.y);
      ctx.rotate(player.angle);
      animationManager.draw(ctx, player.animation, -player.width / 2, -player.height / 2);
      ctx.restore();

      // Draw ball
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = ball.color;
      ctx.fill();
      ctx.closePath();

      // Draw opponents
      ctx.fillStyle = '#FF0000';
      opponents.forEach(function(opponent) {
        ctx.fillRect(opponent.x, opponent.y, opponent.width, opponent.height);
      });

      // Draw selected receiver indicator
      if (currentPlay && currentPlay.type === 'pass') {
        const receiver = opponents.find(o => o.receiver === selectedReceiver);
        if (receiver) {
          ctx.strokeStyle = 'yellow';
          ctx.lineWidth = 2;
          ctx.strokeRect(receiver.x - 5, receiver.y - 5, receiver.width + 10, receiver.height + 10);
        }
      }

      // Restore the context state
      ctx.restore();

      // Draw score
      ctx.fillStyle = '#FFFFFF';
      ctx.font = '24px Arial';
      ctx.fillText('Score: ' + score, 10, 30);

      // Draw game clock and quarter
      const minutes = Math.floor(gameClock / 60);
      const seconds = Math.floor(gameClock % 60);
      ctx.fillText('Q' + quarter + ' ' + minutes + ':' + (seconds < 10 ? '0' : '') + seconds, canvas.width - 150, 30);

      // Draw touchdown message
      if (touchdownMessage) {
        ctx.fillStyle = '#FFFF00';
        ctx.font = '48px Arial';
        ctx.fillText('Touchdown!', canvas.width / 2 - 150, canvas.height / 2);
      }
    }

    function gameLoop() {
      update();
      render();
      requestAnimationFrame(gameLoop);
    }

    const controller = {
      up: false,
      down: false,
      left: false,
      right: false,
      a: false,
      b: false,
      c: false,
      d: false,
      l: false,
      r: false,
    };

    document.getElementById('up').addEventListener('mousedown', function() { controller.up = true; });
    document.getElementById('up').addEventListener('mouseup', function() { controller.up = false; });
    document.getElementById('down').addEventListener('mousedown', function() { controller.down = true; });
    document.getElementById('down').addEventListener('mouseup', function() { controller.down = false; });
    document.getElementById('left').addEventListener('mousedown', function() { controller.left = true; });
    document.getElementById('left').addEventListener('mouseup', function() { controller.left = false; });

    document.getElementById('right').addEventListener('mousedown', function() { controller.right = true; });
    document.getElementById('right').addEventListener('mouseup', function() { controller.right = false; });
    document.getElementById('a-button').addEventListener('mousedown', function() { controller.a = true; });
    document.getElementById('a-button').addEventListener('mouseup', function() { controller.a = false; });
    document.getElementById('b-button').addEventListener('mousedown', function() { controller.b = true; });
    document.getElementById('b-button').addEventListener('mouseup', function() { controller.b = false; });
    document.getElementById('c-button').addEventListener('mousedown', function() { controller.c = true; });
    document.getElementById('c-button').addEventListener('mouseup', function() { controller.c = false; });
    document.getElementById('d-button').addEventListener('mousedown', function() { controller.d = true; });
    document.getElementById('d-button').addEventListener('mouseup', function() { controller.d = false; });
    document.getElementById('l-button').addEventListener('mousedown', function() { controller.l = true; });
    document.getElementById('l-button').addEventListener('mouseup', function() { controller.l = false; });
    document.getElementById('r-button').addEventListener('mousedown', function() { controller.r = true; });
    document.getElementById('r-button').addEventListener('mouseup', function() { controller.r = false; });

    document.getElementById('playerSpeed').addEventListener('input', function(e) {
      player.speed = e.target.value;
    });

    document.getElementById('ballColor').addEventListener('input', function(e) {
      ball.color = e.target.value;
    });

    let gameLoopId;
    document.getElementById('startButton').addEventListener('click', function() {
      if (!gameLoopId) {
        gameLoopId = requestAnimationFrame(gameLoop);
      }
    });

    document.getElementById('stopButton').addEventListener('click', function() {
      if (gameLoopId) {
        cancelAnimationFrame(gameLoopId);
        gameLoopId = null;
      }
    });
  </script>
</body>
</html>
