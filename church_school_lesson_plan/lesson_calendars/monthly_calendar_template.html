<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Monthly Calendar</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <style>
        :root {
            --theme-color-main: #8C1515; /* Cardinal Red */
            --theme-color-light-accent: #f8e1e1;
            --theme-color-dark-accent: #701111;
            --text-color-on-main: white;
            --text-color-on-light: #333;
            --day-cell-height: 140px; /* Increased height for better display */
            --day-header-bg: #f0f0f0;
        }
        body { font-family: sans-serif; background-color: #fff9f9; }
        .calendar-container { max-width: 1200px; margin: auto; }
        .main-page-header { background-color: var(--theme-color-main); color: var(--text-color-on-main); }
        .calendar-header { text-align: center; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .calendar-header h2 { color: var(--theme-color-dark-accent); margin: 0; }
        .calendar-header .nav-arrow { text-decoration: none; color: var(--theme-color-main); font-weight: bold; padding: 0 15px; cursor: pointer; font-size: 1.5em; }
        .calendar-table { width: 100%; border-collapse: collapse; }
        .calendar-table th, .calendar-table td {
            border: 1px solid var(--theme-color-light-accent);
            text-align: left;
            vertical-align: top;
            padding: 8px;
        }
        .calendar-table th {
            background-color: var(--day-header-bg);
            color: var(--theme-color-dark-accent);
            height: 40px;
            text-align: center;
        }
        .calendar-table td {
            height: var(--day-cell-height);
            position: relative;
            transition: background-color 0.3s;
        }
        .day-content { height: 100%; display: flex; flex-direction: column; }
        .day-number { font-weight: bold; color: var(--theme-color-dark-accent); align-self: flex-end; }
        .other-month .day-number { color: #bbb; }
        .other-month { background-color: #fdf5f5; }
        .lesson-title { font-weight: bold; font-size: 0.9em; color: var(--theme-color-main); margin-bottom: 4px; }
        .lesson-details { font-size: 0.8em; line-height: 1.4; }
        .event-note { font-size: 0.8em; color: #555; font-style: italic; margin-top: auto; }
        .clickable { cursor: pointer; }
        .clickable:hover { background-color: var(--theme-color-light-accent); }
        .today { background-color: #fff0b3; }

        @media print {
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print { display: none; }
            .calendar-header { justify-content: center; }
            .calendar-table th { background-color: var(--day-header-bg) !important; color: #000 !important; }
            .calendar-table td { border: 1px solid #ccc !important; height: auto; }
            .other-month { background-color: #f0f0f0 !important; }
            .lesson-title { color: #000 !important; }
            @page { size: landscape; margin: 0.5in; }
        }
    </style>
</head>
<body>

<div class="w3-container">
    <header class="w3-container main-page-header w3-center no-print">
        <h1>Interactive Lesson Calendar</h1>
    </header>

    <div class="calendar-container w3-card-4 w3-margin-top" style="background-color: white;">
        <div class="calendar-header w3-padding">
            <span id="prev-month-btn" class="nav-arrow no-print">&laquo;</span>
            <h2 id="month-year-header"></h2>
            <span id="next-month-btn" class="nav-arrow no-print">&raquo;</span>
        </div>

        <table class="calendar-table">
            <thead>
                <tr>
                    <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
                </tr>
            </thead>
            <tbody id="calendar-body">
                <!-- Calendar days will be generated by JavaScript -->
            </tbody>
        </table>
    </div>
    <footer class="w3-container w3-center w3-margin-top no-print" style="padding: 10px 0;">
        <p class="w3-small">Click on a lesson day to view the detailed plan. Use the arrows to navigate between months.</p>
    </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const calendarBody = document.getElementById('calendar-body');
    const monthYearHeader = document.getElementById('month-year-header');
    const prevMonthBtn = document.getElementById('prev-month-btn');
    const nextMonthBtn = document.getElementById('next-month-btn');

    let currentDate = new Date();
    let lessonData = {};

    function getQueryParameters() {
        const params = new URLSearchParams(window.location.search);
        const year = params.get('year');
        const month = params.get('month');
        if (year && month) {
            currentDate = new Date(parseInt(year), parseInt(month) - 1, 1);
        }
    }

    async function fetchLessonData() {
        try {
            const response = await fetch('lessons.json');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            lessonData = await response.json();
        } catch (error) {
            console.error("Could not fetch lesson data:", error);
            lessonData = {}; // Ensure lessonData is an empty object on failure
        }
    }

    function generateCalendar(date) {
        calendarBody.innerHTML = '';
        const year = date.getFullYear();
        const month = date.getMonth();

        monthYearHeader.textContent = `${date.toLocaleString('default', { month: 'long' })} ${year}`;

        const firstDayOfMonth = new Date(year, month, 1);
        const lastDayOfMonth = new Date(year, month + 1, 0);
        const daysInMonth = lastDayOfMonth.getDate();
        const startDayOfWeek = firstDayOfMonth.getDay(); // 0=Sun, 1=Mon,...

        const today = new Date();
        const todayString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

        let currentDay = 1;
        for (let i = 0; i < 6; i++) { // Max 6 weeks in a month view
            const row = document.createElement('tr');
            for (let j = 0; j < 7; j++) {
                const cell = document.createElement('td');
                if (i === 0 && j < startDayOfWeek) {
                    // Previous month's days
                    const prevMonthLastDay = new Date(year, month, 0).getDate();
                    const dayNum = prevMonthLastDay - startDayOfWeek + j + 1;
                    cell.innerHTML = `<div class="day-content"><span class="day-number">${dayNum}</span></div>`;
                    cell.classList.add('other-month');
                } else if (currentDay > daysInMonth) {
                    // Next month's days
                    const dayNum = currentDay - daysInMonth;
                    cell.innerHTML = `<div class="day-content"><span class="day-number">${dayNum}</span></div>`;
                    cell.classList.add('other-month');
                    currentDay++;
                } else {
                    // Current month's days
                    const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(currentDay).padStart(2, '0')}`;
                    const lesson = lessonData[dateString];

                    let content = `<div class="day-content">
                                     <span class="day-number">${currentDay}</span>`;
                    if (lesson) {
                        content += `<div class="lesson-details">
                                        <span class="lesson-title">${lesson.title}</span>
                                    </div>`;
                        if (lesson.event) {
                             content += `<span class="event-note">${lesson.event}</span>`;
                        }
                        cell.classList.add('clickable');
                        cell.onclick = () => {
                            if (lesson.link && lesson.link !== "#") {
                                window.location.href = lesson.link;
                            }
                        };
                    }
                     content += `</div>`;
                    cell.innerHTML = content;

                    if (dateString === todayString) {
                        cell.classList.add('today');
                    }

                    currentDay++;
                }
                row.appendChild(cell);
            }
            calendarBody.appendChild(row);
            if (currentDay > daysInMonth) break; // Stop if we've passed the last day
        }
    }

    prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        generateCalendar(currentDate);
    });

    nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        generateCalendar(currentDate);
    });

    async function initializeCalendar() {
        getQueryParameters();
        await fetchLessonData();
        generateCalendar(currentDate);
    }

    initializeCalendar();
});
</script>

</body>
</html>