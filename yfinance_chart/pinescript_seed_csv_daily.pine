//@version=6
indicator("GitHub CSV Seed (Daily Refresh)", overlay=true, max_labels_count=500)

// =====================
// Configuration
// =====================
seedSource = input.string("majixai/majixai.github.io", "Seed source (owner/repo)")
seedSymbol = input.string("SPY_LITE", "Seed symbol")
smaLength = input.int(10, "SMA length", minval=1)
showSeedCandles = input.bool(false, "Show seed candles")
showBands = input.bool(true, "Show simple ±1σ bands")

// =====================
// Seed retrieval
// =====================
seedOpen = request.seed(seedSource, seedSymbol, open, ignore_invalid_symbol=true)
seedHigh = request.seed(seedSource, seedSymbol, high, ignore_invalid_symbol=true)
seedLow = request.seed(seedSource, seedSymbol, low, ignore_invalid_symbol=true)
seedClose = request.seed(seedSource, seedSymbol, close, ignore_invalid_symbol=true)
seedVolume = request.seed(seedSource, seedSymbol, volume, ignore_invalid_symbol=true)

// =====================
// Minimal calculations
// =====================
seedSma = ta.sma(seedClose, smaLength)
seedRet = na(seedClose[1]) ? na : (seedClose / seedClose[1] - 1.0)
seedSigma = ta.stdev(seedClose, smaLength)
upperBand = seedSma + seedSigma
lowerBand = seedSma - seedSigma

// =====================
// Plots
// =====================
plot(seedClose, "Seed Close", color=color.new(color.aqua, 0), linewidth=2)
plot(seedSma, "Seed SMA", color=color.new(color.yellow, 0), linewidth=2)
plot(showBands ? upperBand : na, "Upper 1σ", color=color.new(color.green, 0), linewidth=1)
plot(showBands ? lowerBand : na, "Lower 1σ", color=color.new(color.red, 0), linewidth=1)

plotcandle(
     showSeedCandles ? seedOpen : na,
     showSeedCandles ? seedHigh : na,
     showSeedCandles ? seedLow : na,
     showSeedCandles ? seedClose : na,
     title="Seed OHLC",
     color=seedClose >= seedOpen ? color.new(color.green, 0) : color.new(color.red, 0),
     wickcolor=color.new(color.gray, 0),
     bordercolor=color.new(color.gray, 50)
)

// =====================
// Daily refresh marker
// =====================
isNewDay = ta.change(time("D"))
bgcolor(isNewDay ? color.new(color.blue, 92) : na, title="Daily boundary")

// =====================
// Status label
// =====================
var label statusLabel = na
if barstate.islast
    label.delete(statusLabel)
    statusText = na(seedClose) ? "Seed status: no data (check source/symbol mapping)" : "Seed status: loaded"
    statusLabel := label.new(bar_index, high, statusText, style=label.style_label_down, textcolor=color.white, color=color.new(color.black, 0))

// Data Window helpers
plot(seedRet, "Seed Return", color=color.new(color.fuchsia, 0), display=display.data_window)
plot(seedVolume, "Seed Volume", color=color.new(color.orange, 0), display=display.data_window)
